# Telegram bot backend(test task)

### Описание

Тестовое задание представляющее собой телеграмм бота и бэкенд для его работы.
Телеграмм бот выполняют функцию предоставления актуальной информации по курсу валют относительно Евро.
На сайте который опрашивается для получения данных, Евро основная единица, изменение базовой единицы доступно только при вложении средств.
Помимо того что по просьбе бот предоставляет курсы валют, на бота можно подписаться, в таком случае бот будет предоставлять актуальную информацию каждый час.

## Stack

Python 3.11, Django 4.2, Django Rest Framework 3.14.0, celery 5.3.5, django-celery-beat 2.5.0, redis 4.5.4

### Установка, Как запустить проект:

Перейдите в папку с проектом:

```
cd telegram_test_task/
```

В директории backend_telegram создайте .env файл со следующим содержанием:

```
ACCESS_TOKEN=<token> (Токен для доступа к информации можно получить по данному адресу: https://fixer.io/)
TELEGRAM_TOKEN=<telegram_token> (Токен для управления ботом)
SECRET_KEY=<django secret key>
DB_ENGINE=django.db.backends.postgresql
POSTGRES_USER=postgres
DB_NAME=<name>
POSTGRES_PASSWORD=<password>
DB_HOST=db
DB_PORT=5432
CELERY_BROKER=redis://redis:6379/0
CELERY_BACKEND=redis://redis:6379/0
```

Перейти в папку с файлом docker-compose.yml
```
cd infra/
```

Запустить приложение в фоновом режиме:

```
sudo docker compose up -d
```


### Эндпоинты и примеры запросов для взаимодействия с django:

Список запросов:

1. Запросы к эндпоинту юзера:

    GET /api/v1/users/ - Получение списка пользователей подписанных на бота.
    
    GET /api/v1/users/<int:id> - Получение информации о конкретном пользователе

2. Запросы к эндпоинту сообщений:

    GET /api/v1/users/<int:id>/messages - Получение сообщений юзера

    POST /api/v1/users/<int:id>/messages - Создание сообщения пользователя в БД, тело запроса:

    ```json
    {
      "id": 2222222222,
      "username": "example",
      "date": "2023-11-20 13:03:31.111433",
      "text": "example"
    }
    ```
   
    Если пользователь отправивший сообщение ещё не находится в БД, то он будет туда автоматически внесён.

3. Запросы к эндпоинту текстов бота:

    GET /api/v1/bot-texts - Получение всех текстов 

    GET /api/v1/bot-texts/?search=<title> - Получение конкретного текста

    После запуска контейнера будут доступен следующий набор текстов: 

    1. welcome - Приветственное сообщение
    2. currency - Текст для вывода курсов валют
    3. requests_list - Текст для вывода истории сообщений пользователя
    4. basic_exchange_rates - Строка для контроля типов валют на выходе для пользователя

4. Запросы к эндпоинту курсов валют:

    GET /api/v1/сurrency-rate - Получение набора курсов валют

    Через административное пространство можно изменять набор курсов валют для ответа, 
    достаточно добавлять или удалять обозначения валюты в строку текстов с title равным basic_exchange_rates

   
После запуска контейнера для доступа к административному пространству Django можно
воспользоваться следующими данными: username=example, password=example. 
Данный суперюзер реализован исключительно в тестовых целях!!!
   
TODO:

1. Дописать тесты.


Автор:

- [Александр Мамонов](https://github.com/Alex386386) 
